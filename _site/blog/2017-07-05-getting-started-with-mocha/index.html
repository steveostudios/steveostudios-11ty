<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Getting Started with Mocha testing in Javascript</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;900&family=Source+Sans+Pro:wght@300;600;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div class="layout">
    <header>
      <h1>Steve Stone</h1>
      <nav>
        <ul>
          <li><a href="/"><span class="icon"><svg fill="none" height="128" viewBox="0 0 128 128" width="128"
                  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <path
                    d="m62.5 43.9375-34.5 28.5v30.5625c0 1.688 1.3125 3 3 3h21c1.5 0 2.8125-1.312 2.8125-3v-18c0-1.5 1.5-3 3-3h12c1.6875 0 3 1.5 3 3v18c0 1.688 1.5 3 3 3h21.1875c1.5 0 3-1.312 3-3v-30.75l-34.6875-28.3125c-.375-.375-.9375-.5625-1.3125-.5625-.5625 0-1.125.1875-1.5.5625zm54.562 19.3125-15.562-12.9375v-25.875c0-1.3125-1.125-2.25-2.25-2.25h-10.5c-1.3125 0-2.25.9375-2.25 2.25v13.5l-16.875-13.875c-1.3125-1.125-3.9375-1.875-5.8125-1.875-1.6875 0-4.3125.75-5.625 1.875l-47.4375 39.1875c-.5625.375-.9375 1.125-.9375 1.6875s.375 1.125.5625 1.5l4.875 5.8125c.375.375 1.125.75 1.6875.75.375 0 1.125-.1875 1.5-.5625l44.0625-36.1875c.375-.375.9375-.5625 1.5-.5625.375 0 .9375.1875 1.3125.5625l44.0625 36.1875c.375.375 1.125.5625 1.5.5625.563 0 1.313-.375 1.687-.75l4.876-5.8125c.187-.375.562-.9375.562-1.5s-.375-1.3125-.938-1.6875z" />
                </svg></span><span class="title">About</span></a></li>
          <li><a href="/blog"><span class="icon"><svg fill="none" height="128" viewBox="0 0 128 128" width="128"
                  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <path
                    d="m46 94c0-6.5625-5.4375-12-12-12-6.75 0-12 5.4375-12 12 0 6.75 5.25 12 12 12 6.5625 0 12-5.25 12-12zm32.8125 9c-1.5-29.0625-24.75-52.3125-53.8125-53.8125-1.6875-.1875-3 1.3125-3 3v9c0 1.5 1.125 2.8125 2.625 3 21 1.3125 37.875 18.1875 39.1875 39.1875.1875 1.5 1.5 2.625 3 2.625h9c1.6875 0 3.1875-1.312 3-3zm26.9995 0c-1.5-43.875-36.7495-79.3125-80.812-80.8125-1.6875-.1875-3 1.125-3 3v9c0 1.5 1.125 2.8125 2.8125 3 35.8125 1.3125 64.6875 30.1875 66 66.0005.1875 1.687 1.5 3 3 3h8.9995c1.876-.188 3.188-1.5 3-3.188z" />
                </svg></span><span class="title">Blog</span></a></li>
          <li><a href="/books"><span class="icon"><svg fill="none" height="128" viewBox="0 0 128 128" width="128"
                  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <path
                    d="m117.812 99.25-21.3745-79.5c-.5625-2.4375-3-4.3125-5.8125-3.5625l-3 .9375c-1.125.1875-2.0625 1.125-3 2.625-2.625 1.3125-9.75 3.1875-12.75 3.375-1.5-.75-2.8125-1.125-3.9375-.75l-2.8125.75c-.5625.1875-.9375.375-1.125.5625v-1.6875c0-3.1875-2.8125-6-6-6h-12c-3.375 0-6 2.8125-6 6v12h24l18.9375 74.438c.5625 2.437 3 4.312 6 3.562l2.8125-.938c1.125-.187 2.25-1.124 3-2.624 2.625-1.313 9.75-3.188 12.75-3.376 1.5.75 2.812 1.126 3.938.75l3-.75c2.812-.75 3.937-3.562 3.374-5.812zm-25.312-1.3125-17.25-64.5 11.625-3.1875 17.25 64.5zm-82.5-9.9375h24v-48h-24zm18-72h-12c-3.375 0-6 2.8125-6 6v12h24v-12c0-3.1875-2.8125-6-6-6zm-18 90c0 3.375 2.625 6 6 6h12c3.1875 0 6-2.625 6-6v-12h-24zm30-18h24v-48h-24zm0 18c0 3.375 2.625 6 6 6h12c3.1875 0 6-2.625 6-6v-12h-24z" />
                </svg></span><span class="title">Books</span></a></li>
        </ul>
      </nav>
    </header>
    <div class="row column">
      <h1>Getting Started with Mocha testing in Javascript</h1>
<article><p>Testing is one of those things that I have shrugged off for a while. It’s like flossing. I know the benefits. People say that it’s easy. It will make Future-Steve invincible. And, I feel bad about <em>not</em> doing it. It just is one more thing that I am unsure of how to fit into my daily routine. So, with this new project I am working on I decided to do it right from the beginning.</p>
<p>I’m going to show you how to do some basic testing. Our end goal for this post will be to write a test for the following module:</p>
<pre><code>// index.js
const isValidEmail = (email) =&gt; {
  return (email !== null &amp;&amp; /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w+)+$/.test(email)) ? true : false
}
</code></pre>
<p>(Side note: I know that this regular expression is not perfect. There are thousands of these out there and with every one a <em>thousand-and-one critics.</em> That said, we’re gonna write some tests against this function.)</p>
<p>We’re going to use <a href="https://mochajs.org/" title="Mocha">Mocha</a> for our testing framework. Honestly, to get started I looked for the most popular framework and went with that. I don’t know a whole lot about testing at this point, so I wanted to use something well documented and well used.</p>
<p>We’re also going to use <a href="http://chaijs.com/" title="Chai">Chai</a>. From my understanding this is a Mocha plugin that just adds some assertions. It’s gonna make our tests more human-discernible.</p>
<p>Let’s start by installing these:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> i mocha -D<br><span class="token function">npm</span> i chai -D</code></pre>
<p>…and open up our new <code>test.js</code> file.</p>
<p>From here, we need to initiate our Javascript file and let it know what it’s supposed to do.</p>
<pre><code>// test/test.js
'use strict'
const chai = require('chai')
const login = require('../index')
</code></pre>
<p>Here we are using Chai like a plugin by requiring it. Also, we’re require the file we want to test. Makes sense, right?!</p>
<p>Okay, now, let’s write our first <code>describe</code>. A <code>describe</code> tells Mocha how to treat a certain function.</p>
<pre><code>// test/test.js
describe('#isValidEmail', () =&gt; {
  // we're going to put our actual test in here.
}
</code></pre>
<p>Sweet. Now the first test we want to write is to make sure a “normal looking” email address (like “abc@def.com) ”returns true. So, in the describe let’s add our test. (the new stuff is in <strong>bold</strong>).</p>
<pre><code>// test/test.js
describe('#isValidEmail', () =&gt; {
  it('should return true for abc@def.com', () =&gt; {
    var result = login.isValidEmail('abc@def.com')
    chai.expect(result).to.be.true
  })
}
</code></pre>
<p>Now, let’s break this down. The <code>it</code> line should read like a sentence, phrased with <em>“it should…”</em> and then what it should do. Treat this like a note about how the code should test. If the test fails you will see this, so it needs to be helpful as to what this test is actually testing.</p>
<p>Next, we save the result of the function (with the fake email address) as a variable.</p>
<p>Finally, we use Chai to describe what we want the result to look like. It’s crazy how readable this is!</p>
<p>Chai expect[s][the] result to be true.</p>
<p>BOOM! We wrote a test!</p>
<p>…but how do we… <em>test it…</em></p>
<p>It turns out this is ridiculously simple with npm. In your package.json, let’s add a test script</p>
<pre class="language-json"><code class="language-json"><span class="token comment">// package.json</span><br>...<br><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"mocha --reporter spec"</span><br><span class="token punctuation">}</span><br>...</code></pre>
<p>Here we are telling npm that Mocha is our tester. Somehow it will find that <code>test.js</code> file. Now, if we run <code>npm test</code> in our terminal, Mocha should run the test file and should spit out some stuff!</p>
<pre class="language-shell"><code class="language-shell"><span class="token operator">></span> mocha --reporter spec<br><br><span class="token comment">#isValidEmail</span><br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">true</span> <span class="token keyword">for</span> abc@def.com<br><br><span class="token number">1</span> passing <span class="token punctuation">(</span>9ms<span class="token punctuation">)</span></code></pre>
<p>WHAT! This is freaking cool — and easy!</p>
<p>Let’s add a few more tests for giggles:</p>
<pre><code>// user forgot the `something@`
it(&quot;should return false for abcdef.com&quot;, () =&gt; {
  var result = login.isValidEmail(&quot;abcdef.com&quot;);
  chai.expect(result).to.be.false;
});

// user forgot the `.com`
it(&quot;should return false for abc@def&quot;, () =&gt; {
  var result = login.isValidEmail(&quot;abc@def&quot;);
  chai.expect(result).to.be.false;
});

// test for 2 character TLDs
it(&quot;should return true for abc@def.co&quot;, () =&gt; {
  var result = login.isValidEmail(&quot;abc@def.co&quot;);
  chai.expect(result).to.be.true;
});

// test for country TLDs
it(&quot;should return true for abc@def.co.uk&quot;, () =&gt; {
  var result = login.isValidEmail(&quot;abc@def.co.uk&quot;);
  chai.expect(result).to.be.true;
});
</code></pre>
<p>and then run <code>npm test</code>:</p>
<pre class="language-shell"><code class="language-shell"><span class="token operator">></span> mocha --reporter spec<br><br><span class="token comment">#isValidEmail</span><br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">true</span> <span class="token keyword">for</span> abc@def.com<br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">false</span> <span class="token keyword">for</span> abcdef.com<br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">false</span> <span class="token keyword">for</span> abc@def<br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">true</span> <span class="token keyword">for</span> abc@def.co<br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">true</span> <span class="token keyword">for</span> abc@def.co.uk<br><br><span class="token number">5</span> passing <span class="token punctuation">(</span>26ms<span class="token punctuation">)</span></code></pre>
<p>Sweet. Now, let’s say the Future-Steve rides in on his hover-board and messes something up with this function (because in the future I still don’t understand regular expressions!).</p>
<pre><code>// index.js

// removed the bold *(\.\w+)+$ from the old verion
// which is the bit at the end that tell it that it needs the '.com'

// Future-Steve's modified code
const isValidEmail = (email) =&gt; {
return (email !== null &amp;&amp; /^\w+([\.-]?\w+)\*@\w+([\.-]?\w+)/.test(email)) ? true : false
}

</code></pre>
<p>When Future-Steve runs <code>npm test</code>:</p>
<pre class="language-shell"><code class="language-shell"><span class="token operator">></span> mocha --reporter spec<br><br><span class="token comment">#isValidEmail</span><br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">true</span> <span class="token keyword">for</span> abc@def.com<br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">false</span> <span class="token keyword">for</span> abcdef.com <span class="token number">1</span><span class="token punctuation">)</span> should <span class="token builtin class-name">return</span> <span class="token boolean">false</span> <span class="token keyword">for</span> abc@def<br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">true</span> <span class="token keyword">for</span> abc@def.co<br>✓ should <span class="token builtin class-name">return</span> <span class="token boolean">true</span> <span class="token keyword">for</span> abc@def.co.uk<br><br><span class="token number">4</span> passing <span class="token punctuation">(</span>26ms<span class="token punctuation">)</span><br><span class="token number">1</span> failing<br><br><span class="token number">1</span>. <span class="token comment">#isValidEmail should return false for abc@def:</span><br><br>   AssertionError: expected <span class="token boolean">true</span> to be <span class="token boolean">false</span><br><br>   - expected - actual<br><br>   -true<br>   +false<br><br>   at Context.it <span class="token punctuation">(</span>test/test.js:47:30<span class="token punctuation">)</span></code></pre>
<p>Ha! Booyah Future-Steve! In your FACE! Future-Steve will know what he broke and exactly how he can fix it! Pretty cool!</p>
</article>

    </div>
  </div>
</body>

</html>